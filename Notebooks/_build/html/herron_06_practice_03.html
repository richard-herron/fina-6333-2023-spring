

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Herron Topic 6 - Practice (Monday 2:45 PM, Section 3) &#8212; FINA 6333</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'herron_06_practice_03';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Herron Topic 6 - Practice (Wednesday 11:45 AM, Section 4)" href="herron_06_practice_04.html" />
    <link rel="prev" title="Herron Topic 6 - Practice (Blank)" href="herron_06_practice.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="_introduction.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/DMSB_100th_LogoMark_CMYK_Horiz.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/DMSB_100th_LogoMark_CMYK_Horiz.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="_introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures and Practice</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_02_lecture.html">McKinney Chapter 2 - Python Language Basics, IPython, and Jupyter Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice.html">McKinney Chapter 2 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_03.html">McKinney Chapter 2 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_04.html">McKinney Chapter 2 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_02.html">McKinney Chapter 2 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_03_lecture.html">McKinney Chapter 3 - Built-In Data Structures, Functions, and Files</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice.html">McKinney Chapter 3 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice_04.html">McKinney Chapter 3 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice_02.html">McKinney Chapter 3 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_04_lecture.html">McKinney Chapter 4 - NumPy Basics: Arrays and Vectorized Computation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice.html">McKinney Chapter 4 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_03.html">McKinney Chapter 4 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_04.html">McKinney Chapter 4 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_02.html">McKinney Chapter 4 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_05_lecture.html">McKinney Chapter 5 - Getting Started with pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice.html">McKinney Chapter 5 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_03.html">McKinney Chapter 5 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_04.html">McKinney Chapter 5 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_02.html">McKinney Chapter 5 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_01_lecture.html">Herron Topic 1 - Web Data, Log and Simple Returns, and Portfolio Math</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice.html">Herron Topic 1 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_03.html">Herron Topic 1 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_04.html">Herron Topic 1 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_02.html">Herron Topic 1 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_08_lecture.html">McKinney Chapter 8 - Data Wrangling: Join, Combine, and Reshape</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice.html">McKinney Chapter 8 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_03.html">McKinney Chapter 8 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_04.html">McKinney Chapter 8 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_02.html">McKinney Chapter 8 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_10_lecture.html">McKinney Chapter 10 - Data Aggregation and Group Operations</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_10_practice.html">McKinney Chapter 10 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_10_practice_all.html">McKinney Chapter 10 - Practice (All Sections)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_11_lecture.html">McKinney Chapter 11 - Time Series</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice.html">McKinney Chapter 11 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_03.html">McKinney Chapter 11 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_04.html">McKinney Chapter 11 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_02.html">McKinney Chapter 11 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_02_lecture.html">Herron Topic 2 - Trading Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice.html">Herron Topic 2 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_03.html">Herron Topic 2 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_04.html">Herron Topic 2 - Practice (Monday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_02.html">Herron Topic 2 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_03_lecture.html">Herron Topic 3 - Multifactor Models</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice.html">Herron Topic 3 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_03.html">Herron Topic 3 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_04.html">Herron Topic 3 - Practice (Monday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_02.html">Herron Topic 3 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_04_lecture.html">Herron Topic 4 - Portfolio Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice.html">Herron Topic 4 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice_03.html">Herron Topic 4 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice_04.html">Herron Topic 4 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice_02.html">Herron Topic 4 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_05_lecture.html">Herron Topic 5 - Simulations</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice.html">Herron Topic 5 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_03.html">Herron Topic 5 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_04.html">Herron Topic 5 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_02.html">Herron Topic 5 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="herron_06_lecture.html">Herron Topic 6 - Size, Value, and Momentum Investing</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice.html">Herron Topic 6 - Practice (Blank)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Herron Topic 6 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice_04.html">Herron Topic 6 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice_02.html">Herron Topic 6 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_07_lecture.html">Herron Topic 7 - Five Stylized Facts of Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice.html">Herron Topic 7 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_03.html">Herron Topic 7 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_04.html">Herron Topic 7 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_02.html">Herron Topic 7 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quizzes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quiz_01.html">Quiz 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_02.html">Quiz 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_03.html">Quiz 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_04.html">Quiz 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_05.html">Quiz 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_06.html">Quiz 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_07.html">Quiz 7</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="project_01.html">Project 1</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="project_01_solution.html">Project 1 Solution</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project_02.html">Project 2</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/richard-herron/fina-6333-2023-spring/blob/main/Notebooks/herron_06_practice_03.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/richard-herron/fina-6333-2023-spring" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/richard-herron/fina-6333-2023-spring/issues/new?title=Issue%20on%20page%20%2Fherron_06_practice_03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/herron_06_practice_03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Herron Topic 6 - Practice (Monday 2:45 PM, Section 3)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice">Practice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reimplement-the-equal-weighted-momentum-investing-strategy-from-the-lecture-notebook">Reimplement the equal-weighted momentum investing strategy from the lecture notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-a-long-short-portfolio-that-is-long-portfolio-10-and-short-portfolio-1">Add a long-short portfolio that is long portfolio 10 and short portfolio 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-capm-and-ff4-alphas-for-these-equal-weighted-portfolios">What are the CAPM and FF4 alphas for these equal-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-sharpe-ratios-on-these-11-portfolios">What are the Sharpe Ratios on these 11 portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-a-value-weighted-momentum-investing-strategy">Implement a value-weighted momentum investing strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-capm-and-ff4-alphas-for-these-value-weighted-portfolios">What are the CAPM and FF4 alphas for these value-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-sharpe-ratios-for-these-value-weighted-portfolios">What are the Sharpe Ratios for these value-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-an-equal-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">Implement an equal-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-a-value-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">Implement a value-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="herron-topic-6-practice-monday-2-45-pm-section-3">
<h1>Herron Topic 6 - Practice (Monday 2:45 PM, Section 3)<a class="headerlink" href="#herron-topic-6-practice-monday-2-45-pm-section-3" title="Permalink to this heading">#</a></h1>
<section id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Quiz 6 mean and median were about ~~90% and 96%~~  92% and 100%</p>
<ul>
<li><p>Please see the solution on Canvas and let me know if you have any questions</p></li>
<li><p>Gradescope shows which hidden tests you missed</p></li>
<li><p>I recently widened the tolerance on two hidden tests to give full credit if you minimized variance instead of volatility</p></li>
</ul>
</li>
<li><p>I posted <a class="reference internal" href="project_02.html"><span class="doc std std-doc">project 2</span></a> about Bitcoin and gold as inflation and market risk hedges</p></li>
<li><p>Next week (week of 4/10) is the assessment exam</p>
<ul>
<li><p>MSFQ students must take it for 5% of overall course grade</p></li>
<li><p>Non-MSQF students do not take it and weight their grades by only 95%</p></li>
<li><p>20 multiple choice questions on the 6 core courses (corporate finance, investments, math, data analytics, empirical methods, and derivatives)</p></li>
<li><p><em><strong>You must be in the classroom during your assigned date and time to take the MSFQ assessment exam</strong></em></p></li>
<li><p>If there is interest, we will discuss five stylized facts of asset returns after the MSFQ assessment exam</p></li>
<li><p>We will also have our final quiz, quiz 7</p></li>
</ul>
</li>
<li><p>The following week (week of 4/17) we will discuss Herron topic 5 (simulations)</p>
<ul>
<li><p>I will record a lecture video and complete a practice notebook</p></li>
<li><p>But we will reserve class time for group work</p></li>
<li><p>The class voted about 2-to-1 not to drop a topic, so this is a compromise, given that Monday is Patriot’s Day holiday</p></li>
</ul>
</li>
<li><p>The following week (week of 4/24) we will reserve class time for group work</p>
<ul>
<li><p>Project 2 is due Wednesday, 4/26, at 11:59 PM</p></li>
<li><p>Teammates Review 2 is due Wednesday, 4/26, at 11:59 PM</p></li>
<li><p>30,000 DataCamp XP are due Friday, 4/28, at 11:59 PM</p></li>
</ul>
</li>
<li><p><em><strong>Somewhere in there, please reserve 10 minutes to complete a TRACE review for this course</strong></em></p>
<ul>
<li><p>I cannot make you complete TRACE reviews</p></li>
<li><p>But they are very helpful</p></li>
<li><p>I change my courses every semester, hopefully for the better, based on TRACE reviews</p></li>
</ul>
</li>
</ul>
</section>
<section id="practice">
<h2>Practice<a class="headerlink" href="#practice" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="o">%</span><span class="k">precision</span> 4
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">pdr</span>
<span class="kn">import</span> <span class="nn">requests_cache</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests_cache</span><span class="o">.</span><span class="n">CachedSession</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="reimplement-the-equal-weighted-momentum-investing-strategy-from-the-lecture-notebook">
<h3>Reimplement the equal-weighted momentum investing strategy from the lecture notebook<a class="headerlink" href="#reimplement-the-equal-weighted-momentum-investing-strategy-from-the-lecture-notebook" title="Permalink to this heading">#</a></h3>
<p>Try to use a few cells and temporary variables as you can (i.e., perform calculations inside <code class="docutils literal notranslate"><span class="pre">pd.concat()</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crsp</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="s1">&#39;crsp.csv&#39;</span><span class="p">,</span>
        <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
        <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="c1"># we can ignore returns coded as A, B, or C</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">),</span> <span class="c1"># I prefer periods to dates for monthly data</span>
        <span class="n">ME</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;PRC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;SHROUT&#39;</span><span class="p">]</span> <span class="c1"># market value of equity in thousands of dollars</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Please the <a class="reference internal" href="herron_06_lecture.html"><span class="doc std std-doc">Herron Topic 6 lecture notebook</span></a> for variable definitions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crsp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Variable</th>
      <th>SHRCD</th>
      <th>PRC</th>
      <th>RET</th>
      <th>SHROUT</th>
      <th>ME</th>
    </tr>
    <tr>
      <th>PERMNO</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">10000</th>
      <th>1986-01</th>
      <td>10</td>
      <td>-4.3750</td>
      <td>NaN</td>
      <td>3680.0000</td>
      <td>16100.0000</td>
    </tr>
    <tr>
      <th>1986-02</th>
      <td>10</td>
      <td>-3.2500</td>
      <td>-0.2571</td>
      <td>3680.0000</td>
      <td>11960.0000</td>
    </tr>
    <tr>
      <th>1986-03</th>
      <td>10</td>
      <td>-4.4375</td>
      <td>0.3654</td>
      <td>3680.0000</td>
      <td>16330.0000</td>
    </tr>
    <tr>
      <th>1986-04</th>
      <td>10</td>
      <td>-4.0000</td>
      <td>-0.0986</td>
      <td>3793.0000</td>
      <td>15172.0000</td>
    </tr>
    <tr>
      <th>1986-05</th>
      <td>10</td>
      <td>-3.1094</td>
      <td>-0.2227</td>
      <td>3793.0000</td>
      <td>11793.8783</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crsp</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Variable</th>
      <th>SHRCD</th>
      <th>PRC</th>
      <th>RET</th>
      <th>SHROUT</th>
      <th>ME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3794898.0000</td>
      <td>3692827.0000</td>
      <td>3664978.0000</td>
      <td>3791120.0000</td>
      <td>3692827.0000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>10.7392</td>
      <td>31.8232</td>
      <td>0.0115</td>
      <td>44254.7485</td>
      <td>1822175.8177</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.4390</td>
      <td>1835.1071</td>
      <td>0.1799</td>
      <td>249579.2094</td>
      <td>16811017.1404</td>
    </tr>
    <tr>
      <th>min</th>
      <td>10.0000</td>
      <td>-1832.5000</td>
      <td>-0.9957</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>10.0000</td>
      <td>1.8750</td>
      <td>-0.0648</td>
      <td>2288.0000</td>
      <td>16949.2500</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>11.0000</td>
      <td>11.0000</td>
      <td>0.0000</td>
      <td>7336.0000</td>
      <td>73164.0000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>11.0000</td>
      <td>25.8000</td>
      <td>0.0700</td>
      <td>25600.0000</td>
      <td>403080.1875</td>
    </tr>
    <tr>
      <th>max</th>
      <td>11.0000</td>
      <td>528921.0000</td>
      <td>24.0000</td>
      <td>29206400.0000</td>
      <td>2902368140.5592</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To implement a momentum strategy, we need:</p>
<ol class="arabic simple">
<li><p>1-month returns, which are the returns we receive for each holding period</p></li>
<li><p>11-month returns, which are the returns (from month -12 to month -2) that we use to rank stocks and assign to momentum portfolios</p></li>
<li><p>Momentum portfolio assignments based on 11-month trailing returns</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_1m</span> <span class="o">=</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;RET&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There is not a <code class="docutils literal notranslate"><span class="pre">.prod()</span></code> method for <code class="docutils literal notranslate"><span class="pre">.rolling()</span></code>, so the fastest way to calculate 11-month rolling returns is to:</p>
<ol class="arabic simple">
<li><p>Convert simple returns to log returns with <code class="docutils literal notranslate"><span class="pre">.pipe(np.log1p)</span></code></p></li>
<li><p>Calculate 11-month rolling <em>log</em> returns with <code class="docutils literal notranslate"><span class="pre">.rolling(11).sum()</span></code></p></li>
<li><p>Convert log returns to simple returns with <code class="docutils literal notranslate"><span class="pre">.pipe(np.expm1)</span></code></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_11m</span> <span class="o">=</span> <span class="n">ret_1m</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then we use <code class="docutils literal notranslate"><span class="pre">pd.qcut()</span></code> to assign <code class="docutils literal notranslate"><span class="pre">ret_11m</span></code> to ten momentum portfolios.
Here is a simple example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9])
</pre></div>
</div>
</div>
</div>
<p>Here are the momentum portfolios:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_11m</span> <span class="o">=</span> <span class="n">ret_11m</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Short-term reversal, momentum, and long-term reversal represent distinct aspects of asset price behavior that have been observed and documented in the financial markets. As a researcher, I am particularly interested in understanding the underlying factors that contribute to these market anomalies and their implications for trading strategies and portfolio management.</p>
<p>Short-term reversal captures the tendency of asset prices to reverse direction in a brief period, typically days to weeks. This phenomenon can be associated with market overreactions to news events, temporary liquidity constraints, or other transient factors. Astute investors may capitalize on these short-term reversals by adopting a contrarian approach, buying assets that have recently underperformed and selling those that have outperformed.</p>
<p>Momentum represents the persistence of asset price trends over a short to medium-term horizon, typically ranging from 3 to 12 months. This market anomaly suggests that assets with strong recent performance continue to outperform, while poorly performing assets continue to underperform. Momentum can be linked to factors such as investors’ behavioral biases, positive feedback trading, and herd mentality. To exploit momentum, investors may adopt a trend-following strategy, buying assets with strong recent performance and selling those with weak performance.</p>
<p>Long-term reversal, often referred to as mean reversion, is the tendency of asset prices to revert to their long-term average or fundamental value over an extended period, typically several years. This phenomenon is thought to result from market participants gradually recognizing and correcting mispricing, leading to price adjustments. Investors following a long-term reversal strategy may focus on assets with extreme valuation levels, buying undervalued assets and selling overvalued ones, with the expectation that prices will eventually revert to their long-term mean.</p>
<p><em><strong>To avoid short-term reversal, we skip one month between 11-month returns and portfolio formation.</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="n">objs</span><span class="o">=</span><span class="p">[</span>
            <span class="n">ret_1m</span><span class="p">,</span> <span class="c1"># holding period return</span>
            <span class="n">ret_11m</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="c1"># trailing returns</span>
            <span class="n">port_11m</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="c1"># portfolio assignment based on trailing return</span>
            <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># beginning-of-month market value of equity</span>
        <span class="p">],</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">,</span> <span class="s1">&#39;Trailing Return&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span> <span class="s1">&#39;Trailing ME&#39;</span><span class="p">],</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Portfolio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mom</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">])</span>
    <span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># simple mean is an equal-weighted portfolio return</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;Mom &#39;</span><span class="p">)</span> <span class="c1"># simplifies regression specifications below</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Portfolio</th>
      <th>Mom 1</th>
      <th>Mom 2</th>
      <th>Mom 3</th>
      <th>Mom 4</th>
      <th>Mom 5</th>
      <th>Mom 6</th>
      <th>Mom 7</th>
      <th>Mom 8</th>
      <th>Mom 9</th>
      <th>Mom 10</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1927-01</th>
      <td>-0.0006</td>
      <td>0.0149</td>
      <td>0.0425</td>
      <td>0.0378</td>
      <td>0.0009</td>
      <td>0.0150</td>
      <td>0.0124</td>
      <td>0.0076</td>
      <td>-0.0044</td>
      <td>0.0126</td>
    </tr>
    <tr>
      <th>1927-02</th>
      <td>0.0641</td>
      <td>0.0484</td>
      <td>0.0866</td>
      <td>0.0745</td>
      <td>0.0436</td>
      <td>0.0547</td>
      <td>0.0561</td>
      <td>0.0403</td>
      <td>0.0579</td>
      <td>0.0541</td>
    </tr>
    <tr>
      <th>1927-03</th>
      <td>-0.0530</td>
      <td>-0.0381</td>
      <td>-0.0243</td>
      <td>-0.0408</td>
      <td>-0.0192</td>
      <td>-0.0201</td>
      <td>0.0097</td>
      <td>-0.0084</td>
      <td>-0.0058</td>
      <td>0.0012</td>
    </tr>
    <tr>
      <th>1927-04</th>
      <td>0.0230</td>
      <td>-0.0085</td>
      <td>-0.0054</td>
      <td>-0.0061</td>
      <td>0.0002</td>
      <td>-0.0032</td>
      <td>0.0138</td>
      <td>0.0030</td>
      <td>0.0323</td>
      <td>0.0421</td>
    </tr>
    <tr>
      <th>1927-05</th>
      <td>0.0069</td>
      <td>0.0353</td>
      <td>0.0604</td>
      <td>0.0536</td>
      <td>0.0700</td>
      <td>0.0950</td>
      <td>0.0796</td>
      <td>0.0838</td>
      <td>0.0803</td>
      <td>0.0886</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We see a (nearly) monotonic relation between momentum portfolios (based on trailing 11-month returns) and holding period returns!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Monthly Return (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Momentum Strategy</span><span class="se">\n</span><span class="s1"> Equal-Weighted Portfolios</span><span class="se">\n</span><span class="s1">Formed on Months -12 to -2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dcee11a00fc596db568bc2b9d9a59c1ad3c930ab1393a44d9ab81f82af9fe5b0.png" src="_images/dcee11a00fc596db568bc2b9d9a59c1ad3c930ab1393a44d9ab81f82af9fe5b0.png" />
</div>
</div>
<p>This relation is stronger when we consider long-term, buy-and-hold returns!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value of $1 Investment ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Momentum Strategy</span><span class="se">\n</span><span class="s1"> Equal-Weighted Portfolios</span><span class="se">\n</span><span class="s1">Formed on Months -12 to -2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/926694910f626f471321b9624464058f45fc236a7e4ba5d6cd066f7a37832bd1.png" src="_images/926694910f626f471321b9624464058f45fc236a7e4ba5d6cd066f7a37832bd1.png" />
</div>
</div>
</section>
<section id="add-a-long-short-portfolio-that-is-long-portfolio-10-and-short-portfolio-1">
<h3>Add a long-short portfolio that is long portfolio 10 and short portfolio 1<a class="headerlink" href="#add-a-long-short-portfolio-that-is-long-portfolio-10-and-short-portfolio-1" title="Permalink to this heading">#</a></h3>
<p>Call this long-short portfolio UMD.
What are the best and worst months for portfolios 1, 10, and UMD?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span> <span class="o">=</span> <span class="n">mom_ew</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">UMD</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mom 10&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mom 1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The worst month for the long-short portfolio is during the Great Depression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="p">[</span><span class="s1">&#39;UMD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Period(&#39;1932-08&#39;, &#39;M&#39;)
</pre></div>
</div>
</div>
</div>
<p>Momentum strategies appear to generate large absolute returns.
However, long-short momentum strategies are occasionally wiped out by large market recoveries, that the short side of the portfolio does not survive in practice.
During downturns, the short side of the portfolio (i.e., the loser stocks) has a high beta.
When the market unexpectedly and quickly recovers, the exaggerated recovery in the high-beta stocks wipes out the long-short portfolio.
For example, if we invest $1 in the long-short portfolio at the end of 1929, the long-short portfolio is effectively wiped out during August 1932.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1930&#39;</span><span class="p">:</span><span class="s1">&#39;1932&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Mom 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mom 10&#39;</span><span class="p">,</span> <span class="s1">&#39;UMD&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value of $1 Investment ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Momentum Strategy</span><span class="se">\n</span><span class="s1"> Equal-Weighted Portfolios</span><span class="se">\n</span><span class="s1">Formed on Months -12 to -2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4162e1d75dbe30fb44095151c1aa1734e90e085b17d4b8236c0f127dd64e09f2.png" src="_images/4162e1d75dbe30fb44095151c1aa1734e90e085b17d4b8236c0f127dd64e09f2.png" />
</div>
</div>
</section>
<section id="what-are-the-capm-and-ff4-alphas-for-these-equal-weighted-portfolios">
<h3>What are the CAPM and FF4 alphas for these equal-weighted portfolios?<a class="headerlink" href="#what-are-the-capm-and-ff4-alphas-for-these-equal-weighted-portfolios" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>After class, I made the following code more repeatable.</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">capm</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;I(Q(&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&quot;)-RF) ~ Q(&quot;Mkt-RF&quot;)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ff_0</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;F-F_Research_Data_Factors&#39;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;famafrench&#39;</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="s1">&#39;1900&#39;</span><span class="p">,</span>
    <span class="n">session</span><span class="o">=</span><span class="n">session</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ff_mom</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;F-F_Momentum_Factor&#39;</span><span class="p">,</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;famafrench&#39;</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="s1">&#39;1900&#39;</span><span class="p">,</span>
    <span class="n">session</span><span class="o">=</span><span class="n">session</span>
<span class="p">)</span>

<span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mom&#39;</span><span class="p">]</span> <span class="c1"># we need to rename the Mom factor to remove leading and trailing whitespace</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_coefs()</span></code> function accepts a data frame of returns and factors data, a factor model regression function name, and number $n$ for the first $n$ columns in the data frame.
The factor model regression function must return a statsmodel model.
The <code class="docutils literal notranslate"><span class="pre">get_coefs()</span></code> function returns a data frame of coefficient estimates and standard errors.
We can use the <code class="docutils literal notranslate"><span class="pre">get_coefs()</span></code> function to quickly apply a factor model regression function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_coefs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="n">n</span><span class="p">]]</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
    <span class="n">coefs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="n">objs</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">ses</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="n">objs</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">bse</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="n">objs</span><span class="o">=</span><span class="p">[</span><span class="n">coefs</span><span class="p">,</span> <span class="n">ses</span><span class="p">],</span> 
        <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Coef&#39;</span><span class="p">,</span> <span class="s1">&#39;SE&#39;</span><span class="p">],</span> 
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Statistic&#39;</span><span class="p">],</span> 
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_alpha()</span></code> function accepts the output of the <code class="docutils literal notranslate"><span class="pre">get_coefs()</span></code> function and plots portfolio alphas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_alpha</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
    <span class="n">_</span><span class="p">[</span><span class="s1">&#39;Coef&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">_</span><span class="p">[</span><span class="s1">&#39;SE&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Monthly Alpha (%)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can look at the output of <code class="docutils literal notranslate"><span class="pre">get_coefs()</span></code>, but I typically will chain these functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">capm</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Statistic</th>
      <th colspan="2" halign="left">Coef</th>
      <th colspan="2" halign="left">SE</th>
    </tr>
    <tr>
      <th>Variable</th>
      <th>Intercept</th>
      <th>Q("Mkt-RF")</th>
      <th>Intercept</th>
      <th>Q("Mkt-RF")</th>
    </tr>
    <tr>
      <th>Portfolio</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Mom 1</th>
      <td>-0.2642</td>
      <td>1.6488</td>
      <td>0.2364</td>
      <td>0.0438</td>
    </tr>
    <tr>
      <th>Mom 2</th>
      <td>-0.2485</td>
      <td>1.4625</td>
      <td>0.1550</td>
      <td>0.0287</td>
    </tr>
    <tr>
      <th>Mom 3</th>
      <td>-0.1499</td>
      <td>1.3130</td>
      <td>0.1170</td>
      <td>0.0216</td>
    </tr>
    <tr>
      <th>Mom 4</th>
      <td>0.0747</td>
      <td>1.2729</td>
      <td>0.1071</td>
      <td>0.0198</td>
    </tr>
    <tr>
      <th>Mom 5</th>
      <td>0.1002</td>
      <td>1.1657</td>
      <td>0.0874</td>
      <td>0.0162</td>
    </tr>
    <tr>
      <th>Mom 6</th>
      <td>0.2728</td>
      <td>1.1267</td>
      <td>0.0786</td>
      <td>0.0146</td>
    </tr>
    <tr>
      <th>Mom 7</th>
      <td>0.3420</td>
      <td>1.0899</td>
      <td>0.0778</td>
      <td>0.0144</td>
    </tr>
    <tr>
      <th>Mom 8</th>
      <td>0.4860</td>
      <td>1.0698</td>
      <td>0.0794</td>
      <td>0.0147</td>
    </tr>
    <tr>
      <th>Mom 9</th>
      <td>0.5828</td>
      <td>1.0881</td>
      <td>0.0882</td>
      <td>0.0163</td>
    </tr>
    <tr>
      <th>Mom 10</th>
      <td>0.7466</td>
      <td>1.1711</td>
      <td>0.1273</td>
      <td>0.0236</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The beauty of chaining these functions is:</p>
<ol class="arabic simple">
<li><p>We have all calculations in one cell, eliminating the need to track many “off screen” calculations in other cells</p></li>
<li><p>We do not create intermediate data frames, eliminating the need to name and track many data frames</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">capm</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;CAPM Tests of Momentum Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed on Months -12 to -2&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5e1e913e1de9ed0d78aede753ac097b65b1979e747744da61ed4e7ca405d0adc.png" src="_images/5e1e913e1de9ed0d78aede753ac097b65b1979e747744da61ed4e7ca405d0adc.png" />
</div>
</div>
<p>The momentum strategy has a large, positive, statistically significant alpha, suggesting it is a source of risk-adjusted returns (i.e., returns not associated with risk).
However, we saw above that momentum occasionally crashes, suggesting that the momentum strategy has risk.
We will investigate this with the Fama-French Four-Factor model, which add size, value, and momentum factors.
Once we consider SMB, HML, and Mom risk factors, we see:</p>
<ol class="arabic simple">
<li><p>The relation between returns and momentum portfolios is much weaker and not monotonic</p></li>
<li><p>The statistical significance of the alpha coefficient estimates is much lower.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ff4</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;I(Q(&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&quot;)-RF) ~ Q(&quot;Mkt-RF&quot;) + SMB + HML + Mom&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">ff4</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;FF4 Tests of Momentum Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed on Months -12 to -2&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/49d58b0e8f4a15b5f64c08669380a620a5477c654dbd2bd39d8fe61718b6edb4.png" src="_images/49d58b0e8f4a15b5f64c08669380a620a5477c654dbd2bd39d8fe61718b6edb4.png" />
</div>
</div>
<p>A more extreme test is to only consider the last 20 years of returns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">240</span><span class="p">:]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">ff4</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;FF4 Tests of Momentum Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed on Months -12 to -2&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/61e94dbb15479ee32c7ad18ef05875f96952d508778d361dacb6f9ec0d32fdaa.png" src="_images/61e94dbb15479ee32c7ad18ef05875f96952d508778d361dacb6f9ec0d32fdaa.png" />
</div>
</div>
</section>
<section id="what-are-the-sharpe-ratios-on-these-11-portfolios">
<h3>What are the Sharpe Ratios on these 11 portfolios?<a class="headerlink" href="#what-are-the-sharpe-ratios-on-these-11-portfolios" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sharpe</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">ppy</span><span class="p">):</span>
    <span class="n">er</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">tgt</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ppy</span><span class="p">)</span> <span class="o">*</span> <span class="n">er</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">er</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sharpe</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;Sharpe Ratios for Momentum Strategy Relative to RF&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed on Months -12 to -2&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e3f863714a8690aab96231d2252fbc1266e1eb8df9a55c92216420269382a89e.png" src="_images/e3f863714a8690aab96231d2252fbc1266e1eb8df9a55c92216420269382a89e.png" />
</div>
</div>
</section>
<section id="implement-a-value-weighted-momentum-investing-strategy">
<h3>Implement a value-weighted momentum investing strategy<a class="headerlink" href="#implement-a-value-weighted-momentum-investing-strategy" title="Permalink to this heading">#</a></h3>
<p>Assign this strategy to data frame <code class="docutils literal notranslate"><span class="pre">mom_vw</span></code>, and include long-short portfolio UMD</p>
<p>We can replace the <code class="docutils literal notranslate"><span class="pre">.mean()</span></code> method, which calculates simple means (i.e., equal-weighted means), with the <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> method and <code class="docutils literal notranslate"><span class="pre">np.average()</span></code> function, which has a <code class="docutils literal notranslate"><span class="pre">weights=</span></code> argument and calculates weighted means.
We weight portfolio returns by the beginning-of-month marker value of equity in the <code class="docutils literal notranslate"><span class="pre">Trailing</span> <span class="pre">ME</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_vw</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mom</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Trailing ME&#39;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;Mom &#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-are-the-capm-and-ff4-alphas-for-these-value-weighted-portfolios">
<h3>What are the CAPM and FF4 alphas for these value-weighted portfolios?<a class="headerlink" href="#what-are-the-capm-and-ff4-alphas-for-these-value-weighted-portfolios" title="Permalink to this heading">#</a></h3>
<p>The alphas for the value-weighted momentum portfolios are generally smaller in magnitude than for the equal-weighted momentum portfolios.
Equal-weighted portfolios over-weight small stocks relative to value-weighted portfolios, and we expect most anomalies to be stronger in small stocks because small stocks are more difficult for institutional investors to  invest in at scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_vw</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">capm</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;CAPM Tests of Momentum Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Value-Weighted Portfolios Formed on Months -12 to -2&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ced34c2a1d5da1a44cb646030a067d3e0a7d3f3faa565e7aa4f78e1952078890.png" src="_images/ced34c2a1d5da1a44cb646030a067d3e0a7d3f3faa565e7aa4f78e1952078890.png" />
</div>
</div>
<p>The momentum strategy falls apart once we consider the Fama-French Four-Factor model with value-weighted portfolios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_vw</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">ff4</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;FF4 Tests of Momentum Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Value-Weighted Portfolios Formed on Months -12 to -2&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/66e40b5dd92b6085cded9eeb7d2c959f470ca8560f6630174d8dc1235085e3d4.png" src="_images/66e40b5dd92b6085cded9eeb7d2c959f470ca8560f6630174d8dc1235085e3d4.png" />
</div>
</div>
</section>
<section id="what-are-the-sharpe-ratios-for-these-value-weighted-portfolios">
<h3>What are the Sharpe Ratios for these value-weighted portfolios?<a class="headerlink" href="#what-are-the-sharpe-ratios-for-these-value-weighted-portfolios" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mom_vw</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sharpe</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sharpe Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;Sharpe Ratios for Momentum Strategy Relative to RF&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Value-Weighted Portfolios Formed on Months -12 to -2&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f7a171cb8d4193690488883353b1ad5d1c1208f33f2581c2d2f6b793b9526043.png" src="_images/f7a171cb8d4193690488883353b1ad5d1c1208f33f2581c2d2f6b793b9526043.png" />
</div>
</div>
</section>
<section id="implement-an-equal-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">
<h3>Implement an equal-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June<a class="headerlink" href="#implement-an-equal-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june" title="Permalink to this heading">#</a></h3>
<p><em><strong>To show how to form portfolios at lower frequencies, I change this task to form portfolios once a year based on market capitalization from the previous June.</strong></em>
We will assign stocks to portfolios based on market capitalization (i.e., size or the market value of equity) each June and use these portfolio assignments from July through the following June.
That is, we rank in June of year $t$, then hold them in portfolios from July in year $t$ through June in year $t+1$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_june</span> <span class="o">=</span> <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_june</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PERMNO</th>
      <th>10000</th>
      <th>10001</th>
      <th>10002</th>
      <th>10003</th>
      <th>10005</th>
      <th>10006</th>
      <th>10007</th>
      <th>10008</th>
      <th>10009</th>
      <th>10010</th>
      <th>...</th>
      <th>93423</th>
      <th>93426</th>
      <th>93428</th>
      <th>93429</th>
      <th>93430</th>
      <th>93432</th>
      <th>93433</th>
      <th>93434</th>
      <th>93435</th>
      <th>93436</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1926-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>59400.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>59400.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1928-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>57675.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1929-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>57900.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1930-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>30900.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26480 columns</p>
</div></div></div>
</div>
<p>Next we assign portfolios on these June market capitalizations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_june</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PERMNO</th>
      <th>10000</th>
      <th>10001</th>
      <th>10002</th>
      <th>10003</th>
      <th>10005</th>
      <th>10006</th>
      <th>10007</th>
      <th>10008</th>
      <th>10009</th>
      <th>10010</th>
      <th>...</th>
      <th>93423</th>
      <th>93426</th>
      <th>93428</th>
      <th>93429</th>
      <th>93430</th>
      <th>93432</th>
      <th>93433</th>
      <th>93434</th>
      <th>93435</th>
      <th>93436</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1926-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1927-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1928-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1929-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1930-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26480 columns</p>
</div></div></div>
</div>
<p>Note, we want to use these portfolio assignments from July through June, so we need to <code class="docutils literal notranslate"><span class="pre">.shift()</span></code> with <code class="docutils literal notranslate"><span class="pre">freq='1M'</span></code>, which shifts the index one month instead of shifting the values one row.
Because we only have June data, a one-row shift is a one-year shift instead of a one-month shift.
We also need to up sample our June data to monthly date with <code class="docutils literal notranslate"><span class="pre">.resample('M')</span></code> and the <code class="docutils literal notranslate"><span class="pre">.ffill()</span></code> method.
Because we only want to fill forward 12 months, we use <code class="docutils literal notranslate"><span class="pre">.ffill(limit=12)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_june</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;1M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PERMNO</th>
      <th>10000</th>
      <th>10001</th>
      <th>10002</th>
      <th>10003</th>
      <th>10005</th>
      <th>10006</th>
      <th>10007</th>
      <th>10008</th>
      <th>10009</th>
      <th>10010</th>
      <th>...</th>
      <th>93423</th>
      <th>93426</th>
      <th>93428</th>
      <th>93429</th>
      <th>93430</th>
      <th>93432</th>
      <th>93433</th>
      <th>93434</th>
      <th>93435</th>
      <th>93436</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-03</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>7.0000</td>
      <td>3.0000</td>
      <td>NaN</td>
      <td>8.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0000</td>
      <td>NaN</td>
      <td>9.0000</td>
    </tr>
    <tr>
      <th>2022-04</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>7.0000</td>
      <td>3.0000</td>
      <td>NaN</td>
      <td>8.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0000</td>
      <td>NaN</td>
      <td>9.0000</td>
    </tr>
    <tr>
      <th>2022-05</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>7.0000</td>
      <td>3.0000</td>
      <td>NaN</td>
      <td>8.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0000</td>
      <td>NaN</td>
      <td>9.0000</td>
    </tr>
    <tr>
      <th>2022-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>7.0000</td>
      <td>3.0000</td>
      <td>NaN</td>
      <td>8.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0000</td>
      <td>NaN</td>
      <td>9.0000</td>
    </tr>
    <tr>
      <th>2022-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>6.0000</td>
      <td>4.0000</td>
      <td>NaN</td>
      <td>8.0000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0000</td>
      <td>NaN</td>
      <td>9.0000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26480 columns</p>
</div></div></div>
</div>
<p>We can combine the <code class="docutils literal notranslate"><span class="pre">.apply()</span></code>, <code class="docutils literal notranslate"><span class="pre">.shift()</span></code>, <code class="docutils literal notranslate"><span class="pre">.resample()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.fill()</span></code> methods into one operation when we combine the returns, trailing market capitalization, and portfolio assignments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="n">objs</span><span class="o">=</span><span class="p">[</span>
            <span class="n">ret_1m</span><span class="p">,</span>
            <span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;ME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="n">me_june</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;1M&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">],</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">,</span> <span class="s1">&#39;Trailing ME&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">],</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;PERMNO&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Portfolio</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Variable</th>
      <th>Return</th>
      <th>Trailing ME</th>
      <th>Portfolio</th>
    </tr>
    <tr>
      <th>date</th>
      <th>PERMNO</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">1926-07</th>
      <th>10022</th>
      <td>0.2400</td>
      <td>10000.0000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>10030</th>
      <td>0.0211</td>
      <td>19402.5000</td>
      <td>6</td>
    </tr>
    <tr>
      <th>10057</th>
      <td>0.0078</td>
      <td>4031.2500</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10073</th>
      <td>0.0729</td>
      <td>1656.0000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10081</th>
      <td>0.0156</td>
      <td>9536.0000</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_ew</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">me</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">])</span>
    <span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;ME &#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">capm</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;CAPM Tests of Size Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed June Market Value of Equity&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8872db5b249404c8e14edbab82f5358ec876d78ae3ef3d65305b1190711b891a.png" src="_images/8872db5b249404c8e14edbab82f5358ec876d78ae3ef3d65305b1190711b891a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_ew</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">ff4</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;FF4 Tests of Size Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Equal-Weighted Portfolios Formed June Market Value of Equity&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da1a5df44d3d573abd9b0e06810182e2faf2d6075d7ba52d9720be73ab245739.png" src="_images/da1a5df44d3d573abd9b0e06810182e2faf2d6075d7ba52d9720be73ab245739.png" />
</div>
</div>
<p>If we had more time to dig into the size investing strategy, we would find:</p>
<ol class="arabic simple">
<li><p>The alpha is concentrated in January due to tax loss harvesting, where investors sell their losers in December and buy them back in January to earn a tax deduction</p></li>
<li><p>The smallest stocks in the ME 1 portfolio are tiny, making them impractical for institutional investors and allowing the anomaly to persist (because these stocks are small and illiquid, the size factor does not try to explain away their alpha)</p></li>
</ol>
<p>We can quickly see the point 2 above by plotting the mean marker capitalization for each portfolio.
This analysis is “quick and dirty” because we have not inflation adjusted these values.
Still, we quickly see that the ME 10 stocks are 1,000 times larger than the ME 1 stocks, on average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">me</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="p">[</span><span class="s1">&#39;Trailing ME&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;ME &#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Market Value of Equity (Nominal U.S. Dollars)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Market Value of Stocks in ME Portfolios&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9912623f731b1538e1491a458598c59c8be346a294d6d950902f235fd10a843d.png" src="_images/9912623f731b1538e1491a458598c59c8be346a294d6d950902f235fd10a843d.png" />
</div>
</div>
</section>
<section id="implement-a-value-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">
<h3>Implement a value-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June<a class="headerlink" href="#implement-a-value-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june" title="Permalink to this heading">#</a></h3>
<p>With value-weighted portfolios, the size investing strategy alphas disappear!
The alpha disappears because value-weighted portfolios down weight the smallest of the smallest stocks that made the size investing strategy appear to be returns not explained by risk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_vw</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">me</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Portfolio&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Trailing ME&#39;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;ME &#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_vw</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">capm</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;CAPM Tests of Size Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Value-Weighted Portfolios Formed June Market Value of Equity&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3f1ab9c29b78dcf3f973dbae288263b3138d8bf9faea23b8554377f0023b8978.png" src="_images/3f1ab9c29b78dcf3f973dbae288263b3138d8bf9faea23b8554377f0023b8978.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">me_vw</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ff_0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff_mom</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">get_coefs</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">ff4</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">plot_alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;FF4 Tests of Size Strategy&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Value-Weighted Portfolios Formed June Market Value of Equity&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Black Vertical Bars Indicate Standard Errors&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8e1d15ddfe810ce7dbb2eed7e8f77fe665b0dbd55e16bed2bd257f7354616cac.png" src="_images/8e1d15ddfe810ce7dbb2eed7e8f77fe665b0dbd55e16bed2bd257f7354616cac.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="herron_06_practice.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Herron Topic 6 - Practice (Blank)</p>
      </div>
    </a>
    <a class="right-next"
       href="herron_06_practice_04.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Herron Topic 6 - Practice (Wednesday 11:45 AM, Section 4)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice">Practice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reimplement-the-equal-weighted-momentum-investing-strategy-from-the-lecture-notebook">Reimplement the equal-weighted momentum investing strategy from the lecture notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-a-long-short-portfolio-that-is-long-portfolio-10-and-short-portfolio-1">Add a long-short portfolio that is long portfolio 10 and short portfolio 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-capm-and-ff4-alphas-for-these-equal-weighted-portfolios">What are the CAPM and FF4 alphas for these equal-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-sharpe-ratios-on-these-11-portfolios">What are the Sharpe Ratios on these 11 portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-a-value-weighted-momentum-investing-strategy">Implement a value-weighted momentum investing strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-capm-and-ff4-alphas-for-these-value-weighted-portfolios">What are the CAPM and FF4 alphas for these value-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-the-sharpe-ratios-for-these-value-weighted-portfolios">What are the Sharpe Ratios for these value-weighted portfolios?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-an-equal-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">Implement an equal-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-a-value-weighted-size-investing-strategy-based-on-market-capitalization-at-the-start-of-each-month-from-the-previous-june">Implement a value-weighted size investing strategy based on market capitalization ~~at the start of each month~~ from the previous June</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Richard Herron
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>