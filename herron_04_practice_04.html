

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Herron Topic 4 - Practice (Wednesday 11:45 AM, Section 4) &#8212; FINA 6333</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'herron_04_practice_04';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Herron Topic 4 - Practice (Wednesday 2:45 PM, Section 2)" href="herron_04_practice_02.html" />
    <link rel="prev" title="Herron Topic 4 - Practice (Monday 2:45 PM, Section 3)" href="herron_04_practice_03.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="_introduction.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/DMSB_100th_LogoMark_CMYK_Horiz.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/DMSB_100th_LogoMark_CMYK_Horiz.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="_introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures and Practice</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_02_lecture.html">McKinney Chapter 2 - Python Language Basics, IPython, and Jupyter Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice.html">McKinney Chapter 2 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_03.html">McKinney Chapter 2 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_04.html">McKinney Chapter 2 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_02_practice_02.html">McKinney Chapter 2 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_03_lecture.html">McKinney Chapter 3 - Built-In Data Structures, Functions, and Files</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice.html">McKinney Chapter 3 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice_04.html">McKinney Chapter 3 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_03_practice_02.html">McKinney Chapter 3 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_04_lecture.html">McKinney Chapter 4 - NumPy Basics: Arrays and Vectorized Computation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice.html">McKinney Chapter 4 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_03.html">McKinney Chapter 4 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_04.html">McKinney Chapter 4 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_04_practice_02.html">McKinney Chapter 4 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_05_lecture.html">McKinney Chapter 5 - Getting Started with pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice.html">McKinney Chapter 5 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_03.html">McKinney Chapter 5 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_04.html">McKinney Chapter 5 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_05_practice_02.html">McKinney Chapter 5 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_01_lecture.html">Herron Topic 1 - Web Data, Log and Simple Returns, and Portfolio Math</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice.html">Herron Topic 1 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_03.html">Herron Topic 1 - Practice (Section 3, Monday 2:45 PM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_04.html">Herron Topic 1 - Practice (Section 4, Wednesday 11:45 AM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_01_practice_02.html">Herron Topic 1 - Practice (Section 2, Wednesday 2:45 PM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_08_lecture.html">McKinney Chapter 8 - Data Wrangling: Join, Combine, and Reshape</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice.html">McKinney Chapter 8 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_03.html">McKinney Chapter 8 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_04.html">McKinney Chapter 8 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_08_practice_02.html">McKinney Chapter 8 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_10_lecture.html">McKinney Chapter 10 - Data Aggregation and Group Operations</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_10_practice.html">McKinney Chapter 10 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_10_practice_all.html">McKinney Chapter 10 - Practice (All Sections)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mckinney_11_lecture.html">McKinney Chapter 11 - Time Series</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice.html">McKinney Chapter 11 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_03.html">McKinney Chapter 11 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_04.html">McKinney Chapter 11 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mckinney_11_practice_02.html">McKinney Chapter 11 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_02_lecture.html">Herron Topic 2 - Trading Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice.html">Herron Topic 2 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_03.html">Herron Topic 2 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_04.html">Herron Topic 2 - Practice (Monday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_02_practice_02.html">Herron Topic 2 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_03_lecture.html">Herron Topic 3 - Multifactor Models</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice.html">Herron Topic 3 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_03.html">Herron Topic 3 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_04.html">Herron Topic 3 - Practice (Monday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_03_practice_02.html">Herron Topic 3 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="herron_04_lecture.html">Herron Topic 4 - Portfolio Optimization</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice.html">Herron Topic 4 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice_03.html">Herron Topic 4 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Herron Topic 4 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_04_practice_02.html">Herron Topic 4 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_05_lecture.html">Herron Topic 5 - Simulations</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice.html">Herron Topic 5 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_03.html">Herron Topic 5 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_04.html">Herron Topic 5 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_05_practice_02.html">Herron Topic 5 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_06_lecture.html">Herron Topic 6 - Size, Value, and Momentum Investing</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice.html">Herron Topic 6 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice_03.html">Herron Topic 6 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice_04.html">Herron Topic 6 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_06_practice_02.html">Herron Topic 6 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="herron_07_lecture.html">Herron Topic 7 - Five Stylized Facts of Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice.html">Herron Topic 7 - Practice (Blank)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_03.html">Herron Topic 7 - Practice (Monday 2:45 PM, Section 3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_04.html">Herron Topic 7 - Practice (Wednesday 11:45 AM, Section 4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="herron_07_practice_02.html">Herron Topic 7 - Practice (Wednesday 2:45 PM, Section 2)</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quizzes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quiz_01.html">Quiz 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_02.html">Quiz 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_03.html">Quiz 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_04.html">Quiz 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_05.html">Quiz 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_06.html">Quiz 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="quiz_07.html">Quiz 7</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="project_01.html">Project 1</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="project_01_solution.html">Project 1 Solution</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project_02.html">Project 2</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/richard-herron/fina-6333-2023-spring" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/richard-herron/fina-6333-2023-spring/issues/new?title=Issue%20on%20page%20%2Fherron_04_practice_04.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/herron_04_practice_04.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Herron Topic 4 - Practice (Wednesday 11:45 AM, Section 4)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice">Practice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-short-weights-up-to-10-on-each-stock">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow short weights up to 10% on each stock</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-total-short-weights-of-up-to-30">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow total short weights of up to 30%</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-do-not-allow-any-weight-to-exceed-30-in-magnitude">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but do not allow any weight to exceed 30% in magnitude</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-95-value-at-risk-var-portfolio-of-matana-stocks-over-the-last-three-years">Find the minimum 95% Value at Risk (Var) portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-maximum-draw-down-portfolio-of-matana-stocks-over-the-last-three-years">Find the minimum maximum draw down portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-maximum-draw-down-portfolio-with-all-available-data-for-the-current-dow-jones-industrial-average-djia-stocks">Find the minimum maximum draw down portfolio with all available data for the current Dow-Jones Industrial Average (DJIA) stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-mean-variance-efficient-frontier-with-all-available-data-for-the-current-the-djia-stocks">Plot the (mean-variance) efficient frontier with all available data for the current the DJIA stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-with-all-available-data-for-the-current-the-djia-stocks">Find the maximum Sharpe Ratio portfolio with all available data for the current the DJIA stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-frac-1-n-and-maximum-sharpe-ratio-portfolios-with-all-available-data-for-the-current-djia-stocks">Compare the $\frac{1}{n}$ and maximum Sharpe Ratio portfolios with all available data for the current DJIA stocks</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="herron-topic-4-practice-wednesday-11-45-am-section-4">
<h1>Herron Topic 4 - Practice (Wednesday 11:45 AM, Section 4)<a class="headerlink" href="#herron-topic-4-practice-wednesday-11-45-am-section-4" title="Permalink to this heading">#</a></h1>
<section id="announcements">
<h2>Announcements<a class="headerlink" href="#announcements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Quiz 6 this week</p>
<ul>
<li><p>I will post it at about 6 PM on Wednesday, 3/31</p></li>
<li><p>It will be due by 11:59 PM on Friday, 3/31</p></li>
</ul>
</li>
<li><p>Please complete the week ten survey</p>
<ul>
<li><p>I am considering dropping a topic to allow more in-class group work and easier access to me</p></li>
<li><p>I am also curious why the quantitative courses are less popular this summer</p></li>
<li><p>Please complete by 11:59 PM on Friday, 3/31</p></li>
<li><p><em><strong>The week ten survey is anonymous and voluntary</strong></em></p></li>
</ul>
</li>
<li><p>I will post project 2 as soon as I can</p></li>
<li><p>Assessment exam</p>
<ul>
<li><p>20 questions multiple on Canvas</p></li>
<li><p>You must be in the room</p></li>
<li><p>No specific studying, but I suggest putting core course resources on your laptop (e.g., notes and PowerPoints)</p></li>
</ul>
</li>
</ul>
</section>
<section id="practice">
<h2>Practice<a class="headerlink" href="#practice" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="o">%</span><span class="k">precision</span> 4
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">pdr</span>
<span class="kn">import</span> <span class="nn">requests_cache</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">requests_cache</span><span class="o">.</span><span class="n">CachedSession</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">sco</span>
</pre></div>
</div>
</div>
</div>
<section id="find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years">
<h3>Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years<a class="headerlink" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years" title="Permalink to this heading">#</a></h3>
<p><em><strong>Note that <code class="docutils literal notranslate"><span class="pre">sco.minimize()</span></code> finds minimums, so we need to minimize the negative Sharpe Ratio.</strong></em></p>
<p>The following code downloads data for the MATANA stocks and assigns daily decimal returns from 2020 through 2022 to data frame <code class="docutils literal notranslate"><span class="pre">returns</span></code>.
We will stop in 2022 to make it easier to compare our results, whether we use the risk-free rate or value-weighted market portfolio as our benchmark or not.
Recall, the Fama and French benchmark factors are only available with a lag, and are only available through December 2022 as I type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tickers</span> <span class="o">=</span> <span class="s1">&#39;MSFT AAPL TSLA AMZN NVDA GOOG&#39;</span>

<span class="n">matana</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">tickers</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="s1">&#39;Ticker&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">returns</span> <span class="o">=</span> <span class="n">matana</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020&#39;</span><span class="p">:</span><span class="s1">&#39;2022&#39;</span><span class="p">]</span>
<span class="n">returns</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Ticker</th>
      <th>AAPL</th>
      <th>AMZN</th>
      <th>GOOG</th>
      <th>MSFT</th>
      <th>NVDA</th>
      <th>TSLA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.0011</td>
      <td>0.0002</td>
      <td>0.0006</td>
      <td>0.0008</td>
      <td>0.0018</td>
      <td>0.0030</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.0233</td>
      <td>0.0246</td>
      <td>0.0217</td>
      <td>0.0219</td>
      <td>0.0352</td>
      <td>0.0455</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.1286</td>
      <td>-0.1405</td>
      <td>-0.1110</td>
      <td>-0.1474</td>
      <td>-0.1845</td>
      <td>-0.2106</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.0110</td>
      <td>-0.0129</td>
      <td>-0.0097</td>
      <td>-0.0097</td>
      <td>-0.0177</td>
      <td>-0.0215</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.0006</td>
      <td>0.0006</td>
      <td>0.0012</td>
      <td>0.0007</td>
      <td>0.0029</td>
      <td>0.0020</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.0142</td>
      <td>0.0123</td>
      <td>0.0114</td>
      <td>0.0123</td>
      <td>0.0222</td>
      <td>0.0251</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.1198</td>
      <td>0.1354</td>
      <td>0.0940</td>
      <td>0.1422</td>
      <td>0.1716</td>
      <td>0.1989</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">ppy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    x: portfolio weights (must be first arg to use with sco.minimize())</span>
<span class="sd">    r: data frame of portfolio returns</span>
<span class="sd">    tgt: target or benchmark for Sharpe Ratio</span>
<span class="sd">    ppy: return periods per year</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">er</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">tgt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ppy</span><span class="p">)</span> <span class="o">*</span> <span class="n">er</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">er</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_sharpe_neg</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">ppy</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">ppy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_1</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="c1"># eq constraints are driven to 0</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_sharpe_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -1.0891990229341466
     jac: array([ 1.1644e-04,  3.6243e-01,  1.1961e-01,  6.4995e-02,  4.9078e-04,
       -2.5971e-04])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 63
     nit: 9
    njev: 9
  status: 0
 success: True
       x: array([6.6101e-02, 3.5779e-17, 4.3043e-17, 7.2642e-18, 3.1307e-01,
       6.2083e-01])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_sharpe_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0891990229341466
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-short-weights-up-to-10-on-each-stock">
<h3>Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow short weights up to 10% on each stock<a class="headerlink" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-short-weights-up-to-10-on-each-stock" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_2</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">],</span> <span class="c1"># short up to 5 stocks 10%, then long the other stock 150%</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="c1"># eq constraints are driven to 0</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_sharpe_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -1.1368990243538257
     jac: array([0.041 , 0.3444, 0.1157, 0.0727, 0.041 , 0.041 ])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 63
     nit: 9
    njev: 9
  status: 0
 success: True
       x: array([ 0.2997, -0.1   , -0.1   , -0.1   ,  0.3745,  0.6258])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Long Only&#39;</span><span class="p">:</span><span class="n">res_sharpe_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> 
            <span class="s1">&#39;Up to 10% Short per Stock&#39;</span><span class="p">:</span><span class="n">res_sharpe_2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="n">index</span><span class="o">=</span><span class="n">returns</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;Portfolio Weight&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison Max. Sharpe Ratio Portfolio Weights&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/004163d333021c4843934510f0bca8e93ff174a2d8ca8aae95ac07868ddfaaea.png" src="_images/004163d333021c4843934510f0bca8e93ff174a2d8ca8aae95ac07868ddfaaea.png" />
</div>
</div>
<p>By relaxing the long-only constrain (via changes to <code class="docutils literal notranslate"><span class="pre">bounds=</span></code>), the weights on AMZN, GOOG, and MSFT go from zero to -10%.
Also, the Sharpe Ratio increases because we relax a binding constraint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">res_sharpe_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0891990229341466
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">res_sharpe_2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1368990243538257
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-total-short-weights-of-up-to-30">
<h3>Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow total short weights of up to 30%<a class="headerlink" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-total-short-weights-of-up-to-30" title="Permalink to this heading">#</a></h3>
<p>We can find the negative values in a NumPy array as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>
<span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3, -2, -1])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_3</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">],</span> <span class="c1"># short up to 5 stocks 10%, then long the other stock 150%</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># eq constraints are driven to 0</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">}</span> <span class="c1"># ineq constraints must be non-negative</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_sharpe_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -1.1826806520985051
     jac: array([0.0784, 0.3361, 0.152 , 0.1097, 0.0773, 0.0772])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 100
     nit: 10
    njev: 10
  status: 0
 success: True
       x: array([ 3.5706e-01, -3.0000e-01, -4.1390e-09,  1.8703e-05,  3.4943e-01,
        5.9349e-01])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Long Only&#39;</span><span class="p">:</span><span class="n">res_sharpe_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> 
            <span class="s1">&#39;Up to 30% Short Total&#39;</span><span class="p">:</span><span class="n">res_sharpe_2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="n">index</span><span class="o">=</span><span class="n">returns</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;Portfolio Weight&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison Max. Sharpe Ratio Portfolios&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9191ee6b277076599561ec2ccfc4e2c05a524e1504c24b98f5dfcbe9c357f2a1.png" src="_images/9191ee6b277076599561ec2ccfc4e2c05a524e1504c24b98f5dfcbe9c357f2a1.png" />
</div>
</div>
<p>Again, by relaxing the long-only constrain, the weights on AMZN, GOOG, and MSFT go from zero to -10%.
Also, the Sharpe Ratio increases because we relax a binding constraints.
The Sharpe Ratio is higher here than in the previous exercise, but this will not always be the case, since we relax different constraints here and in the previous exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">res_sharpe_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0891990229341466
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">res_sharpe_3</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1826806520985051
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-do-not-allow-any-weight-to-exceed-30-in-magnitude">
<h3>Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but do not allow any weight to exceed 30% in magnitude<a class="headerlink" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-do-not-allow-any-weight-to-exceed-30-in-magnitude" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_4</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># want eq constraint to = 0</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_sharpe_4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 0.0
     jac: array([0., 0., 0., 0., 0., 0.])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 7
     nit: 1
    njev: 1
  status: 0
 success: True
       x: array([0.1667, 0.1667, 0.1667, 0.1667, 0.1667, 0.1667])
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-minimum-95-value-at-risk-var-portfolio-of-matana-stocks-over-the-last-three-years">
<h3>Find the minimum 95% Value at Risk (Var) portfolio of MATANA stocks over the last three years<a class="headerlink" href="#find-the-minimum-95-value-at-risk-var-portfolio-of-matana-stocks-over-the-last-three-years" title="Permalink to this heading">#</a></h3>
<p>More on VaR <a class="reference external" href="https://en.wikipedia.org/wiki/Value_at_risk">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_var</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_var_neg</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">port_var</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_var_1</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_var_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># minimize drives &quot;eq&quot; constraints to zero</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_var_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 0.03592251751051852
     jac: array([0.0359, 0.0419, 0.037 , 0.0385, 0.0275, 0.0416])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 45
     nit: 5
    njev: 5
  status: 0
 success: True
       x: array([1.8180e-01, 1.4369e-01, 2.2517e-01, 2.4347e-01, 2.0587e-01,
       4.4129e-19])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_var</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_var_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.03592251751051852
</pre></div>
</div>
</div>
</div>
<p>It might be helpful to slightly change then minimum VaR portfolio weights to show that we minimized VaR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tweak</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">d</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_var</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tweak</span><span class="p">(</span><span class="n">res_var_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.036229497993286966
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-minimum-maximum-draw-down-portfolio-of-matana-stocks-over-the-last-three-years">
<h3>Find the minimum maximum draw down portfolio of MATANA stocks over the last three years<a class="headerlink" href="#find-the-minimum-maximum-draw-down-portfolio-of-matana-stocks-over-the-last-three-years" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_draw_down_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">rp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
    <span class="n">cum_max</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span>
    <span class="n">draw_down</span> <span class="o">=</span> <span class="p">(</span><span class="n">cum_max</span> <span class="o">-</span> <span class="n">price</span><span class="p">)</span> <span class="o">/</span> <span class="n">cum_max</span>
    <span class="k">return</span> <span class="n">draw_down</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_dd_1</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_draw_down_max</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns</span><span class="p">,),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># minimize drives &quot;eq&quot; constraints to zero</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_dd_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 0.2973740650996654
     jac: array([0.2865, 0.5131, 0.4028, 0.2927, 0.5359, 0.7698])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 164
     nit: 19
    njev: 19
  status: 0
 success: True
       x: array([6.8105e-01, 3.7577e-16, 1.3585e-16, 3.1895e-01, 7.7695e-16,
       7.2563e-16])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_draw_down_max</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_dd_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2974
</pre></div>
</div>
</div>
</div>
<p>Again. it might be helpful to slightly change then minimum VaR portfolio weights to show that we minimized VaR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_draw_down_max</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tweak</span><span class="p">(</span><span class="n">res_dd_1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="n">r</span><span class="o">=</span><span class="n">returns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3065
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-minimum-maximum-draw-down-portfolio-with-all-available-data-for-the-current-dow-jones-industrial-average-djia-stocks">
<h3>Find the minimum maximum draw down portfolio with all available data for the current Dow-Jones Industrial Average (DJIA) stocks<a class="headerlink" href="#find-the-minimum-maximum-draw-down-portfolio-with-all-available-data-for-the-current-dow-jones-industrial-average-djia-stocks" title="Permalink to this heading">#</a></h3>
<p>You can find the <a class="reference external" href="https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average">DJIA tickers on Wikipedia</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wiki</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average&#39;</span><span class="p">)</span>
<span class="n">tickers</span> <span class="o">=</span> <span class="n">wiki</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Symbol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">djia</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">tickers</span><span class="o">=</span><span class="n">tickers</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="s1">&#39;Ticker&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">returns_2</span> <span class="o">=</span> <span class="n">djia</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020&#39;</span><span class="p">:</span><span class="s1">&#39;2022&#39;</span><span class="p">]</span>
<span class="n">returns_2</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Ticker</th>
      <th>AAPL</th>
      <th>AMGN</th>
      <th>AXP</th>
      <th>BA</th>
      <th>CAT</th>
      <th>CRM</th>
      <th>CSCO</th>
      <th>CVX</th>
      <th>DIS</th>
      <th>DOW</th>
      <th>...</th>
      <th>MRK</th>
      <th>MSFT</th>
      <th>NKE</th>
      <th>PG</th>
      <th>TRV</th>
      <th>UNH</th>
      <th>V</th>
      <th>VZ</th>
      <th>WBA</th>
      <th>WMT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>...</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
      <td>756.0000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.0011</td>
      <td>0.0004</td>
      <td>0.0007</td>
      <td>0.0000</td>
      <td>0.0010</td>
      <td>0.0001</td>
      <td>0.0003</td>
      <td>0.0011</td>
      <td>-0.0004</td>
      <td>0.0005</td>
      <td>...</td>
      <td>0.0006</td>
      <td>0.0008</td>
      <td>0.0005</td>
      <td>0.0005</td>
      <td>0.0007</td>
      <td>0.0011</td>
      <td>0.0004</td>
      <td>-0.0003</td>
      <td>-0.0002</td>
      <td>0.0004</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.0233</td>
      <td>0.0176</td>
      <td>0.0286</td>
      <td>0.0383</td>
      <td>0.0224</td>
      <td>0.0278</td>
      <td>0.0199</td>
      <td>0.0268</td>
      <td>0.0241</td>
      <td>0.0272</td>
      <td>...</td>
      <td>0.0161</td>
      <td>0.0219</td>
      <td>0.0238</td>
      <td>0.0152</td>
      <td>0.0210</td>
      <td>0.0208</td>
      <td>0.0211</td>
      <td>0.0132</td>
      <td>0.0231</td>
      <td>0.0162</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.1286</td>
      <td>-0.0826</td>
      <td>-0.1482</td>
      <td>-0.2385</td>
      <td>-0.1428</td>
      <td>-0.1589</td>
      <td>-0.1373</td>
      <td>-0.2212</td>
      <td>-0.1316</td>
      <td>-0.2166</td>
      <td>...</td>
      <td>-0.0986</td>
      <td>-0.1474</td>
      <td>-0.1281</td>
      <td>-0.0874</td>
      <td>-0.2080</td>
      <td>-0.1728</td>
      <td>-0.1355</td>
      <td>-0.0674</td>
      <td>-0.1096</td>
      <td>-0.1138</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.0110</td>
      <td>-0.0080</td>
      <td>-0.0130</td>
      <td>-0.0173</td>
      <td>-0.0106</td>
      <td>-0.0137</td>
      <td>-0.0085</td>
      <td>-0.0108</td>
      <td>-0.0123</td>
      <td>-0.0124</td>
      <td>...</td>
      <td>-0.0073</td>
      <td>-0.0097</td>
      <td>-0.0104</td>
      <td>-0.0060</td>
      <td>-0.0087</td>
      <td>-0.0080</td>
      <td>-0.0099</td>
      <td>-0.0061</td>
      <td>-0.0104</td>
      <td>-0.0067</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.0006</td>
      <td>-0.0003</td>
      <td>0.0004</td>
      <td>-0.0014</td>
      <td>0.0010</td>
      <td>0.0005</td>
      <td>0.0000</td>
      <td>0.0008</td>
      <td>-0.0012</td>
      <td>-0.0002</td>
      <td>...</td>
      <td>0.0000</td>
      <td>0.0007</td>
      <td>0.0000</td>
      <td>0.0008</td>
      <td>0.0017</td>
      <td>0.0011</td>
      <td>0.0007</td>
      <td>-0.0002</td>
      <td>-0.0007</td>
      <td>0.0001</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.0142</td>
      <td>0.0081</td>
      <td>0.0123</td>
      <td>0.0152</td>
      <td>0.0123</td>
      <td>0.0149</td>
      <td>0.0093</td>
      <td>0.0133</td>
      <td>0.0106</td>
      <td>0.0142</td>
      <td>...</td>
      <td>0.0084</td>
      <td>0.0123</td>
      <td>0.0123</td>
      <td>0.0075</td>
      <td>0.0101</td>
      <td>0.0095</td>
      <td>0.0106</td>
      <td>0.0054</td>
      <td>0.0107</td>
      <td>0.0077</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.1198</td>
      <td>0.1090</td>
      <td>0.2188</td>
      <td>0.2432</td>
      <td>0.1033</td>
      <td>0.2604</td>
      <td>0.1337</td>
      <td>0.2274</td>
      <td>0.1441</td>
      <td>0.2091</td>
      <td>...</td>
      <td>0.0837</td>
      <td>0.1422</td>
      <td>0.1553</td>
      <td>0.1201</td>
      <td>0.1329</td>
      <td>0.1280</td>
      <td>0.1384</td>
      <td>0.0721</td>
      <td>0.1260</td>
      <td>0.1171</td>
    </tr>
  </tbody>
</table>
<p>8 rows  30 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_dd_2</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_draw_down_max</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns_2</span><span class="p">,),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns_2</span><span class="p">],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># minimize drives &quot;eq&quot; constraints to zero</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_dd_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 0.1452611244311275
     jac: array([0.1974, 0.064 , 0.2211, 0.2242, 0.1603, 0.0966, 0.162 , 0.1158,
       0.2333, 0.1664, 0.1609, 0.1217, 0.0695, 0.0094, 0.2134, 0.0657,
       0.1275, 0.0835, 0.0717, 0.1171, 0.0113, 0.1175, 0.1914, 0.1776,
       0.0756, 0.1588, 0.1089, 0.0882, 0.1333, 0.2522])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 879
     nit: 27
    njev: 27
  status: 0
 success: True
       x: array([7.4317e-17, 2.6652e-02, 4.9022e-17, 0.0000e+00, 8.4813e-17,
       4.0861e-17, 0.0000e+00, 4.8595e-19, 8.3224e-17, 4.6493e-20,
       2.0382e-17, 1.0975e-16, 7.4798e-20, 1.2327e-17, 3.6385e-17,
       1.3723e-01, 7.9003e-17, 2.1395e-19, 5.0830e-17, 0.0000e+00,
       1.9045e-01, 1.3055e-01, 2.6484e-17, 3.0680e-17, 3.8500e-17,
       3.7442e-19, 2.4126e-17, 1.2647e-01, 0.0000e+00, 3.8864e-01])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_draw_down_max</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_dd_2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1453
</pre></div>
</div>
</div>
</div>
<p>Again. it might be helpful to slightly change then minimum VaR portfolio weights to show that we minimized VaR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_draw_down_max</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tweak</span><span class="p">(</span><span class="n">res_dd_2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1519
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-mean-variance-efficient-frontier-with-all-available-data-for-the-current-the-djia-stocks">
<h3>Plot the (mean-variance) efficient frontier with all available data for the current the DJIA stocks<a class="headerlink" href="#plot-the-mean-variance-efficient-frontier-with-all-available-data-for-the-current-the-djia-stocks" title="Permalink to this heading">#</a></h3>
<p>The range of target returns in <code class="docutils literal notranslate"><span class="pre">tret</span></code> span from the minimum to the maximum mean single-stock returns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span>
<span class="n">tret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">_</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will loop over these target returns, finding the minimum variance portfolio for each target return.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_vol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ppy</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ppy</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">port_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ppy</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ppy</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_ef</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tret</span><span class="p">:</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
        <span class="n">fun</span><span class="o">=</span><span class="n">port_vol</span><span class="p">,</span> <span class="c1"># minimize portfolio volatility</span>
        <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># initial portfolio weights</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns_2</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="c1"># additional arguments to fun, in order</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span> <span class="c1"># bounds limit the search space for each portfolio weight</span>
        <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># constrain sum of weights to one</span>
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">port_mean</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">}</span> <span class="c1"># constrains portfolio mean return to the target return</span>

        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">res_ef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>List <code class="docutils literal notranslate"><span class="pre">res_ef</span></code> contains the results of all 25 minimum-variance portfolios.
For example, <code class="docutils literal notranslate"><span class="pre">res_ef[0]</span></code> is the minimum variance portfolio for the lowest target return.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_ef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 0.4206024526789833
     jac: array([0.226 , 0.1289, 0.2273, 0.2753, 0.1603, 0.2102, 0.1879, 0.1846,
       0.1792, 0.1971, 0.2016, 0.1831, 0.1662, 0.1612, 0.4206, 0.0915,
       0.1934, 0.1133, 0.122 , 0.1283, 0.0833, 0.2267, 0.1728, 0.1111,
       0.1504, 0.1597, 0.1808, 0.0838, 0.154 , 0.0955])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 93
     nit: 3
    njev: 3
  status: 0
 success: True
       x: array([1.7984e-15, 1.9459e-15, 0.0000e+00, 0.0000e+00, 3.1500e-15,
       0.0000e+00, 0.0000e+00, 9.2610e-16, 0.0000e+00, 0.0000e+00,
       6.8625e-16, 0.0000e+00, 0.0000e+00, 0.0000e+00, 1.0000e+00,
       0.0000e+00, 0.0000e+00, 0.0000e+00, 1.4480e-15, 0.0000e+00,
       0.0000e+00, 0.0000e+00, 1.0790e-15, 0.0000e+00, 1.1208e-15,
       0.0000e+00, 1.2956e-16, 5.8070e-16, 0.0000e+00, 0.0000e+00])
</pre></div>
</div>
</div>
</div>
<p>I typically check that all portfolio volatility minimization succeeds.
If a portfolio volatility minimization fails, we should check our function, bounds, and constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res_ef</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<p>We can combine the target returns and volatilities into a data frame <code class="docutils literal notranslate"><span class="pre">ef</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;tret&#39;</span><span class="p">:</span> <span class="n">tret</span><span class="p">,</span>
        <span class="s1">&#39;tvol&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res_ef</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">ef</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tret</th>
      <th>tvol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.1535</td>
      <td>0.4206</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.1358</td>
      <td>0.3435</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.1181</td>
      <td>0.2757</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.1004</td>
      <td>0.2253</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.0827</td>
      <td>0.2027</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ef</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;tvol&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;tret&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Annualized Mean Return (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Annualized Volatility (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;Efficient Frontier for Dow-Jones Industrial Average Stocks&#39;</span> <span class="o">+</span>
    <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">from </span><span class="si">{</span><span class="n">returns_2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">%B %d, %Y</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">returns_2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">%B %d, %Y</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="n">returns_2</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
    <span class="n">returns_2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)),</span>
    <span class="n">returns_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
<span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/43956a28cfa168eb1d249195f6a0fa16932abafc198ea4b80a17b3280a195942.png" src="_images/43956a28cfa168eb1d249195f6a0fa16932abafc198ea4b80a17b3280a195942.png" />
</div>
</div>
</section>
<section id="find-the-maximum-sharpe-ratio-portfolio-with-all-available-data-for-the-current-the-djia-stocks">
<h3>Find the maximum Sharpe Ratio portfolio with all available data for the current the DJIA stocks<a class="headerlink" href="#find-the-maximum-sharpe-ratio-portfolio-with-all-available-data-for-the-current-the-djia-stocks" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_6</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns_2</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="c1"># want eq constraint to = 0</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_sharpe_6</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.44191670887963796
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-the-frac-1-n-and-maximum-sharpe-ratio-portfolios-with-all-available-data-for-the-current-djia-stocks">
<h3>Compare the $\frac{1}{n}$ and maximum Sharpe Ratio portfolios with all available data for the current DJIA stocks<a class="headerlink" href="#compare-the-frac-1-n-and-maximum-sharpe-ratio-portfolios-with-all-available-data-for-the-current-djia-stocks" title="Permalink to this heading">#</a></h3>
<p>Use all but the last 252 trading days to estimate the maximum Sharpe Ratio portfolio weights.
Then use the last 252 trading days of data to compare the $\frac{1}{n}$  maximum Sharpe Ratio portfolios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_x</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;2021&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns_2</span><span class="p">],</span> <span class="c1"># short up to 5 stocks 10%, then long the other stock 150%</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># eq constraints are driven to 0</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">res_sharpe_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -1.45101908912907
     jac: array([-3.3379e-05,  7.1544e-01,  3.6336e-01,  1.5581e+00, -5.4866e-05,
        2.6187e-01,  3.1877e-01,  6.4522e-01,  6.0754e-01,  5.1480e-01,
        2.2540e-02, -2.8282e-05,  4.4621e-01,  4.4353e-01,  1.1298e+00,
        2.2024e-01,  4.9128e-01,  3.9944e-01,  2.4492e-01,  4.7485e-01,
        6.0061e-01,  3.6554e-04, -1.0265e-03,  1.1015e-01,  4.1630e-01,
        1.2803e-02,  6.8370e-01,  5.0606e-01,  5.0418e-01,  1.4875e-01])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 218
     nit: 7
    njev: 7
  status: 0
 success: True
       x: array([5.1283e-01, 0.0000e+00, 4.7142e-17, 7.0902e-16, 1.0012e-02,
       0.0000e+00, 1.5765e-16, 1.1636e-16, 0.0000e+00, 0.0000e+00,
       0.0000e+00, 2.5708e-01, 0.0000e+00, 0.0000e+00, 1.2567e-15,
       0.0000e+00, 0.0000e+00, 0.0000e+00, 0.0000e+00, 1.7025e-16,
       4.7163e-18, 1.7922e-01, 4.0854e-02, 0.0000e+00, 7.3800e-17,
       0.0000e+00, 3.5034e-16, 1.1696e-17, 2.2730e-16, 0.0000e+00])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">returns_2</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">res_sharpe_x</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum Sharpe Ratio&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Equal Weight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Portfolio Weight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;Portfolio Weights for Dow-Jones Industrial Average Stocks&#39;</span> <span class="o">+</span>
    <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">from </span><span class="si">{</span><span class="n">returns_2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">%b %d, %Y</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">returns_2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">%b %d, %Y</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ed3faa8fc73c2e844f027f25089fe052145d884b806b964b4e67bef53f91593e.png" src="_images/ed3faa8fc73c2e844f027f25089fe052145d884b806b964b4e67bef53f91593e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_sharpe_x</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022&#39;</span><span class="p">],</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.753001293587445
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">returns_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022&#39;</span><span class="p">],</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.25436552600712903
</pre></div>
</div>
</div>
</div>
<p>It is hard to beat the $\frac{1}{n}$ portfolio because mean returns (and covariances) are hard to predict!</p>
<hr class="docutils" />
<p>What if we picked a different period?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">returns_3</span> <span class="o">=</span> <span class="n">djia</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2010&#39;</span><span class="p">:</span><span class="s1">&#39;2019&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_xp1</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">port_sharpe_neg</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">returns_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">returns_3</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;2017&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">returns_3</span><span class="p">],</span> <span class="c1"># short up to 5 stocks 10%, then long the other stock 150%</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">},</span> <span class="c1"># eq constraints are driven to 0</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_sharpe_xp1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -1.731278080433011
     jac: array([ 8.2898e-04,  1.7132e-01,  6.2183e-01,  6.6705e-04,  5.1273e-01,
        5.8156e-02,  7.1817e-01,  5.8716e-01,  2.4546e-01,  1.0825e+00,
       -6.6045e-04,  2.9742e-01,  7.8327e-01,  3.4385e-01,  1.2937e-02,
        6.9605e-01,  2.2715e-01, -5.5020e-04,  2.2086e-01,  4.1068e-01,
        2.3549e-01,  9.3803e-02,  1.7122e-01,  1.2081e-01,  9.5281e-04,
       -6.2662e-04, -7.7012e-04,  3.4866e-01,  5.7884e-02])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 273
     nit: 9
    njev: 9
  status: 0
 success: True
       x: array([1.1385e-01, 3.4971e-16, 5.0862e-16, 7.1293e-02, 0.0000e+00,
       1.4777e-18, 0.0000e+00, 3.7423e-17, 1.6828e-16, 3.6013e-16,
       3.1237e-01, 1.3929e-16, 0.0000e+00, 2.2603e-17, 1.0282e-16,
       2.0842e-16, 1.6927e-16, 2.0434e-01, 6.9230e-17, 3.2044e-17,
       8.4599e-17, 1.3271e-16, 5.6371e-17, 2.0042e-16, 2.3077e-01,
       5.2373e-02, 1.5005e-02, 5.5219e-17, 7.0648e-17])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">returns_3</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">res_sharpe_xp1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum Sharpe Ratio&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Equal Weight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Portfolio Weight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s1">&#39;Portfolio Weights for Dow-Jones Industrial Average Stocks&#39;</span> <span class="o">+</span>
    <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">from </span><span class="si">{</span><span class="n">returns_3</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">%b %d, %Y</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">returns_3</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">%b %d, %Y</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d1b7fb21fa5827c49ea187152662da7786148c1cccd535eb399fd6eda3421d9e.png" src="_images/d1b7fb21fa5827c49ea187152662da7786148c1cccd535eb399fd6eda3421d9e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res_sharpe_xp1</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018&#39;</span><span class="p">:</span><span class="s1">&#39;2019&#39;</span><span class="p">],</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0491764710165667
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">port_sharpe</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">returns_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">returns_3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">returns_3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018&#39;</span><span class="p">:</span><span class="s1">&#39;2019&#39;</span><span class="p">],</span> <span class="n">tgt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ppy</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9908235050926001
</pre></div>
</div>
</div>
</div>
<p>It is hard to beat the $\frac{1}{n}$ portfolio!
The $\frac{1}{n}$ portfolio is hard to beat because return means and covariances are hard to predict!</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="herron_04_practice_03.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Herron Topic 4 - Practice (Monday 2:45 PM, Section 3)</p>
      </div>
    </a>
    <a class="right-next"
       href="herron_04_practice_02.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Herron Topic 4 - Practice (Wednesday 2:45 PM, Section 2)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#announcements">Announcements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice">Practice</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-short-weights-up-to-10-on-each-stock">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow short weights up to 10% on each stock</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-allow-total-short-weights-of-up-to-30">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but allow total short weights of up to 30%</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-of-matana-stocks-over-the-last-three-years-but-do-not-allow-any-weight-to-exceed-30-in-magnitude">Find the maximum Sharpe Ratio portfolio of MATANA stocks over the last three years, but do not allow any weight to exceed 30% in magnitude</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-95-value-at-risk-var-portfolio-of-matana-stocks-over-the-last-three-years">Find the minimum 95% Value at Risk (Var) portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-maximum-draw-down-portfolio-of-matana-stocks-over-the-last-three-years">Find the minimum maximum draw down portfolio of MATANA stocks over the last three years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-minimum-maximum-draw-down-portfolio-with-all-available-data-for-the-current-dow-jones-industrial-average-djia-stocks">Find the minimum maximum draw down portfolio with all available data for the current Dow-Jones Industrial Average (DJIA) stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-mean-variance-efficient-frontier-with-all-available-data-for-the-current-the-djia-stocks">Plot the (mean-variance) efficient frontier with all available data for the current the DJIA stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-the-maximum-sharpe-ratio-portfolio-with-all-available-data-for-the-current-the-djia-stocks">Find the maximum Sharpe Ratio portfolio with all available data for the current the DJIA stocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-frac-1-n-and-maximum-sharpe-ratio-portfolios-with-all-available-data-for-the-current-djia-stocks">Compare the $\frac{1}{n}$ and maximum Sharpe Ratio portfolios with all available data for the current DJIA stocks</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Richard Herron
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>